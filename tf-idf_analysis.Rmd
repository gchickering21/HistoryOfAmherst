---
title: "TF-DIF analysis"
author: "Clara Seo"
date: "10/02/2020"
output: pdf_document
---

```{r setup, include=FALSE}
library(readtext)
library(tidytext)
library(tidyverse)
library(tokenizers)
library(stopwords)
library(dplyr)
library(tidyr)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE)
```

```{r data read-in}
# Read in all files from a folder called "chapter_files"
texts_df <- read.csv(file="all_texts.csv")
```

```{r}
n_chapters <- nrow(texts_df)
text <- c("")
book <- data.frame(text)

## This gets all the chapters into their own separate df's
for (i in 1:n_chapters) {
  # single string of text that contains the entire chapter
  temp_chapter <- texts_df[i, 3]
  string_chapter <- stringr::str_split(temp_chapter, "\n")[[1]]
  num_lines <- length(string_chapter)
  chapter_df <- tibble(line = 1:num_lines, text = string_chapter) %>% select(text)
  book <- rbind(book, chapter_df)
  # rename string with appropriate chapter number
  assign(paste("chapter", i - 1, "_df", sep = ""), chapter_df)
}
```

```{r}
ACbook_counts <- texts_df %>%
  select(-X) %>% 
  
  #prepare data in useable format for text analysis
  tidytext::unnest_tokens(word, text) %>%
  
  # exclude stop words (i.e. the, an, a, you)
  anti_join(tidytext::get_stopwords(), by = "word") %>%
  
  # count word frequencies for a given chapter
  count(doc_id, word, sort = TRUE) %>%
  mutate(freq=n) %>%
  select(doc_id, word, freq)

tidy_DTM <- ACbook_counts %>%
  tidytext::bind_tf_idf(word, doc_id, freq)

tidy_DTM %>%
  arrange(desc(tf)) %>%
  head()
```

```{r sentiment}
ACbook_sentiment <- tidy_DTM %>%
  inner_join(get_sentiments("bing"), by = "word") %>% 
  count(doc_id, sentiment) %>% 
  spread(sentiment, n, fill = 0) %>% 
  mutate(sentiment = positive - negative)
```
